# Spatial Navigation protocol

This file contains information on the required software to run the tasks and get
logfiles to use for posterior analysis, as well as instructions and clarifications
about the naming conventions, software and file structure used by us.

## Table of contents
1. [Python version and dependencies](#Python version and dependencies)
2. [How to run the tasks](#How to run the tasks)
3. [How to get logfiles from the tasks](#How to get logfiles from the tasks)
4. [Where can I find X in the code? (Adjustments help)](#Where can I find X in the code?)

## Python version and dependencies

This experimen has been developed using Vizard 6. To run the tasks, you will need.

It is a propietary software, so you have two options:

1. Acquire a license from [Vizard](https://www.worldviz.com/vizard-virtual-reality-software)
2. Use the executable file provided in this folder (*** TODO: CREATE EXECUTABLE)

The problem with the second option is that you will not be able to make any changes from how we prepared
the experiment, which can lead to some problems. The most obvious one being that all the texts are in french.

Whether you buy a license or decide to use the executable, you won't need anything else to run the tasks. Vizard
runs in python, but contains everything needed for it to work.

## How to run the tasks

This will be different depending on whether you run the tasks from [Vizard](#Vizard) 
or from the [executable file](#Executable).

### Vizard

Once you open Vizard, go to the File > Open tab, open the 'protocol' folder and then select the python scripts
you wish to open. The training and main tasks are in the main_fmri.py and training_fmri.py, respectively.

Once open, navigate to the script and press F5 to start running the task. You will see a prompt asking for the
subject number, and another one asking for the desired starting run (main only). The latter will allow you to 
re-start the experiment in case you have to abruptly stop the execution of the task for whatever reason.

The starting run prompt works with Python indexing logic (that is, starting from 0), so 0 corresponds to the first
run, and 7 to the eighth and last (in our case).

After that, the tasks will start.

### Executable

The executable works exactly the same as initiating a Vizard script. Once you run it, you will see a prompt asking 
for the subject number, and another one asking for the desired starting run. See the section above for more details.

### Other considerations when running the tasks

Since the timing of the answers to the task are dictated by the participant, there is a fixation cross at the end
that will be displayed indefinitely when the run ends. You must press the key 'c' in your keyboard and then the
protocol will be waiting for a scanner pulse (keypress 't' in our case) to start the next run.

It is important to note that later, when generating the logfiles, the script will interpret the 'c' keypress as the
end of the run, so it is important to press the key when the scanner ends.

It is also possible to start the experiment from a run different han the first one. When launching
the protocol, a prompt will ask for the desired starting run: '0' is the first one, and '7' the last
(since we did eight). Important note: Do not press 'c' when waiting for the scanner pulse if you start
from a later run. This can cause a bug when extracting the events files.

## How to get logfiles from the tasks

Once the program ends, you will find 3 files in the 'protocol/logs' folder. We are only interested in the one ending
in '*_main.csv'. go to the paradigm_descriptors folder (in the same folder as this README file) and there you will
find the python script to extract the useful information. You can run it using the following command:

    $ python paradigm_descriptors_extraction.py -n [subject_number]
    
The script will look for all the events files generated by the script for that subject (in case you had to stop
and there is more than one) and generate one distinct file per run, that will be saved in 'paradigm_descriptors/
paradigm_descriptors_extraction'.

## Where can I find X in the code?

### Text in the experiment

All the text of the experiment can be found in the 'instructions.py' file. If you don't find there what you are 
looking for, some text is also present in the 'loadResources.py'.

### Number of trials per run

Currently, the experiment has eight runs with 8 experimental trials and 4 control trials each. If you wish to 
change that, go to the 'defineOptions.py' script, line 143 onwards. There you will be able to change the number 
of experimental and control trials. There is no explicit coding for the number of runs, since that is controled
by the sequence that generates the trials. We have not changed this from the original implementation, and if you
with to go there, you can find it in the 'loadResources.py' script.

Additionally, you can change the length of the blocks, while respecting the total number of trials, by changing
the digits of the list pauseTrials, just below the number of experimental and control trials in 'defineOptions.py'
    

